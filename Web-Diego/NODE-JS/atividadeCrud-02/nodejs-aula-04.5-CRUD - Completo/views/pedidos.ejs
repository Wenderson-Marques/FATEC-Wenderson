<%- include ('partials/header.ejs') %>
<%- include ('partials/navbar.ejs') %>
<!-- <script>
    // FAZENDO REQUISIÇÃO AJAX PARA OBTENÇÃO DO ÚLTIMO NÚMERO DE PEDIDO
    fetch("/pedidos/last")
        .then(response => response.json())
        .then(data => {
            const ultimoNumero = data.ultimoNumero;
            const novoNumero = ultimoNumero + 1;
            document.getElementById('numero').value = novoNumero; // Preenche o campo do formulário com o novo número.
        })
        .catch(error => console.error('Erro ao obter o último número de pedido:', error));
</script> -->

<div class="container">
    <div class="card">
        <div class="card-header">
            <h1>Cadastrar pedido</h1>
        </div>
        <div class="card-body">
            <form action="/pedidos/new" method="POST">
                <label>Numero do pedido:</label>
                <input type="text" name="numero" id="numero" placeholder="Insira o numero do pedido" class="form-control" required>

                <label>Valor:</label>
                <input type="text" name="cpf" id="cpf" placeholder="Insira o Valor  do pedido" class="form-control" required>
                <button class="btn btn-success" class="refresh">Cadastrar</button>
            </form>
            <hr>
        </div>
    </div>
</div>
<br>

<div class="container">
    <div class="card">
        <div class="card-header">
            <h1>Pedidos</h1>
        </div>
        <div class="card-body">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>numero:</th>
                        <th>valor:</th>
                        <th style="text-align: center;" colspan="2">Ações:</th>
                    </tr>
                </thead>
                <tbody>
                    <% pedidos.forEach(pedido => { %>
                    <tr>
                        <td><img width="30px" src="imgs/avatar.png" alt="pedidos"></td>
                        <td><%= pedido.numero %></td>
                        <td><%= pedido.valor %></td>
                        <td><a style="color: orange;" href="/pedidos/edit/<%= pedido._id %>" >Editar</a></td>
                        <td><a style="color: red;" href="/pedidos/delete/<%= pedido._id %>" onclick="return confirm('Confirma a exclusão do registro?')"class="refresh">Excluir</a></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<%- include ('partials/footer.ejs') %>